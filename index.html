<!--
  –ù–æ–≤–∞—è –ó–µ–º–ª—è ‚Äî single-file —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∞–π—Ç
  –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–∞–∫ index.html –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.

  –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:
  - –î–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: –Ω–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏ (–í–ª–∞–¥–µ–ª–µ—Ü)" –∏–ª–∏ "–í–æ–π—Ç–∏ (–ê–¥–º–∏–Ω)" –∏ –≤–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å.
    –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: –≤–ª–∞–¥–µ–ª–µ—Ü owner123, –∞–¥–º–∏–Ω admin123 ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏—Ç–µ –≤ –∫–æ–¥–µ/–ª–æ–∫–∞–ª—å–Ω–æ–ºStorage
  - –í–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç: –º–µ–Ω—è—Ç—å –ø–∞—Ä–æ–ª–∏, –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø—É–±–ª–∏—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —ç–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö.
  - –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ø—ã, –ø—Ä–∞–≤–∏–ª–∞, –∑–∞–≥—Ä—É–∂–∞—Ç—å –∫–∞—Ä—Ç—É.
  - –î–ª—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –≠–∫—Å–ø–æ—Ä—Ç/–ò–º–ø–æ—Ä—Ç (–æ–±–º–µ–Ω JSON) –∏–ª–∏ –ø–æ–ø—Ä–æ—Å–∏—Ç–µ –º–µ–Ω—è –¥–æ–±–∞–≤–∏—Ç—å –±—ç–∫–µ–Ω–¥ (Firebase/Replit/etc).

  –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: —ç—Ç–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥. –ü–∞—Ä–æ–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ localStorage ‚Äî —É–¥–æ–±—Å—Ç–≤–æ, –Ω–æ –Ω–µ –∑–∞—â–∏—â–µ–Ω–æ –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.
  –î–ª—è –Ω–∞—Å—Ç–æ—è—â–µ–π –º–Ω–æ–≥–æ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å–∏—Å—Ç–µ–º—ã –Ω—É–∂–µ–Ω —Å–µ—Ä–≤–µ—Ä/–ë–î –∏ —Ä–µ–∞–ª—å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è.
-->

<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>–ù–æ–≤–∞—è –ó–µ–º–ª—è ‚Äî –æ—Ñ—Ñ–ª–∞–π–Ω –¥–µ–º–æ</title>
  <meta name="description" content="–°–∞–π—Ç-—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –¥–ª—è –∏–≥—Ä—ã "–ù–æ–≤–∞—è –ó–µ–º–ª—è" ‚Äî –ø—Ä–∞–≤–∏–ª–∞, –∫–∞—Ä—Ç–∞, —Ç–æ–ø—ã –∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#6ee7b7;--muted:#9aa4b2;--glass: rgba(255,255,255,0.03)}
    *{box-sizing:border-box}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial; margin:0;background:linear-gradient(180deg,#071127 0%, #071827 100%);color:#e6eef6}
    .container{max-width:1100px;margin:28px auto;padding:20px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:54px;height:54px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#60a5fa);display:flex;align-items:center;justify-content:center;font-weight:800;color:#022}
    h1{margin:0;font-size:20px}
    .nav-buttons{display:flex;gap:8px;align-items:center}
    button{background:var(--glass);border:1px solid rgba(255,255,255,0.04);padding:8px 12px;border-radius:10px;color:inherit;cursor:pointer}
    button.primary{background:linear-gradient(90deg,var(--accent),#60a5fa);color:#022;border:none}
    .hero{display:grid;grid-template-columns:1fr 380px;gap:18px;margin-top:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:16px;border-radius:14px;border:1px solid rgba(255,255,255,0.03)}
    .welcome{padding:22px}
    .welcome h2{margin:0 0 8px 0}
    .muted{color:var(--muted);font-size:14px}
    .map-area img{width:100%;height:auto;border-radius:10px;display:block}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .tabs{display:flex;gap:8px;margin-top:12px}
    .tab{padding:8px 12px;border-radius:8px;background:rgba(255,255,255,0.02);cursor:pointer}

    /* top lists */
    .grids{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:14px}
    .list{padding:12px}
    table{width:100%;border-collapse:collapse}
    td,th{padding:6px;text-align:left;border-bottom:1px dashed rgba(255,255,255,0.03);font-size:14px}
    th{font-weight:600}

    /* accordion */
    .accordion-item{border-radius:10px;margin-top:8px;overflow:hidden}
    .accordion-head{display:flex;justify-content:space-between;align-items:center;padding:10px;background:rgba(255,255,255,0.01);cursor:pointer}
    .accordion-body{padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent)}

    footer{margin-top:24px;text-align:center;color:var(--muted);font-size:13px}

    /* admin badge */
    .badge{padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.04);font-weight:600}

    /* responsive */
    @media(max-width:900px){.hero{grid-template-columns:1fr} .grids{grid-template-columns:1fr}}

    /* small helpers */
    .flex{display:flex;gap:8px;align-items:center}
    input[type=file]{display:none}
    .uploader{display:flex;gap:6px;align-items:center}
    .toast{position:fixed;right:20px;bottom:20px;background:#0b1220;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04)}
    .small{font-size:13px;color:var(--muted)}
    .editor{border:1px dashed rgba(255,255,255,0.04);padding:8px;border-radius:8px}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">NZ</div>
        <div>
          <h1>–ù–æ–≤–∞—è –ó–µ–º–ª—è</h1>
          <div class="small muted">–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∏–≥—Ä—ã ‚Äî –∫–∞—Ä—Ç–∞, –ø—Ä–∞–≤–∏–ª–∞, —Ç–æ–ø—ã –∏ –∞–¥–º–∏–Ω–∫–∞</div>
        </div>
      </div>
      <div class="nav-buttons">
        <div id="roleBadge" class="badge">–ì–æ—Å—Ç—å</div>
        <button onclick="showSection('map')">–ö–∞—Ä—Ç–∞</button>
        <button onclick="showSection('rules')">–ü—Ä–∞–≤–∏–ª–∞</button>
        <button onclick="showSection('tops')">–¢–æ–ø—ã</button>
        <button class="primary" onclick="promptLogin('owner')">–í–æ–π—Ç–∏ (–í–ª–∞–¥–µ–ª–µ—Ü)</button>
        <button onclick="promptLogin('admin')">–í–æ–π—Ç–∏ (–ê–¥–º–∏–Ω)</button>
      </div>
    </header>

    <main class="hero">
      <section class="card welcome" id="section-welcome">
        <h2>–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é –≤ ¬´–ù–æ–≤–æ–π –ó–µ–º–ª–µ¬ª</h2>
        <p class="muted">–ó–¥–µ—Å—å –≤—ã –Ω–∞–π–¥—ë—Ç–µ –∫–∞—Ä—Ç—É, –ø—Ä–∞–≤–∏–ª–∞ –∏ —Ç–µ–∫—É—â–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∏ –ø–ª–µ–º—ë–Ω. –î–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Ö–æ–¥ –∫–∞–∫ –í–ª–∞–¥–µ–ª–µ—Ü –∏–ª–∏ –ê–¥–º–∏–Ω.</p>

        <div class="controls">
          <button onclick="showSection('map')">–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É</button>
          <button onclick="showSection('tops')">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–æ–ø—ã</button>
          <button onclick="showSection('rules')">–ü—Ä–∞–≤–∏–ª–∞ –∏ —Å–∏—Å—Ç–µ–º—ã</button>
          <button onclick="scrollTo('#admin')">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</button>
        </div>

        <div class="tabs">
          <div class="tab" onclick="quickAction('giveEnergyAll')">+20 ‚ö° –≤—Å–µ–º (–¥–µ–º–æ)</div>
          <div class="tab" onclick="quickAction('randomEvent')">–°–ª—É—á–∞–π–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ</div>
        </div>

        <div style="margin-top:12px" id="welcomeText" class="small editor" contenteditable="false">
          <strong>–ù–æ–≤–∞—è –ó–µ–º–ª—è</strong> ‚Äî –∏–≥—Ä–∞ –≤ Telegram: –∏–≥—Ä–æ–∫–∏ —Å–æ–∑–¥–∞—é—Ç —Å—Ç—Ä–∞–Ω—ã, —Ç—Ä–∞—Ç—è—Ç —ç–Ω–µ—Ä–≥–∏—é –Ω–∞ —Ä–∞–∑–≤–µ–¥–∫—É –∏ –∑–∞—Ö–≤–∞—Ç —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–π. –ù–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—ã –º–æ–∂–µ—Ç–µ —Ö—Ä–∞–Ω–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç—É, –ø—Ä–∞–≤–∏–ª–∞ –∏ —Ä–µ–π—Ç–∏–Ω–≥–∏.
        </div>

      </section>

      <aside class="card map-area">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>–ö–∞—Ä—Ç–∞ (–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–≤–æ—é)</strong>
          <div class="small muted">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è PNG/JPG</div>
        </div>

        <div style="margin-top:10px">
          <label class="uploader">
            <input id="mapFile" type="file" accept="image/*" onchange="loadMap(event)">
            <button>–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ä—Ç—É</button>
          </label>
          <button onclick="resetMap()">–°–±—Ä–æ—Å–∏—Ç—å</button>
        </div>

        <div style="margin-top:12px">
          <img id="mapPreview" src="" alt="–ö–∞—Ä—Ç–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞" style="display:none">
        </div>

        <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
          <button onclick="togglePublicEdit()">–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –ø—É–±–ª–∏—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
          <button onclick="exportData()">–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
          <label style="display:inline-block">
            <input type="file" id="importFile" accept="application/json" onchange="importData(event)" style="display:none">
            <button onclick="document.getElementById('importFile').click()">–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
          </label>
        </div>

      </aside>
    </main>

    <!-- –¢–∞–±—ã/–°–µ–∫—Ü–∏–∏ -->
    <div class="card" style="margin-top:14px" id="section-map" hidden>
      <h3>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞</h3>
      <p class="muted">–ó–∞–≥—Ä—É–∂–∞–π—Ç–µ –∫–∞—Ä—Ç—É, –æ—Ç–º–µ—á–∞–π—Ç–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ (–¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—á–Ω—ã—Ö –º–∞—Ä–∫–µ—Ä–æ–≤).</p>
      <div id="mapMarkers" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:8px;margin-top:12px"></div>
      <div class="small muted" style="margin-top:10px">–§—É–Ω–∫—Ü–∏–∏: –∫–ª–∏–∫ –ø–æ –ø–ª–µ–º–µ–Ω–∏ ‚Äî —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (—Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ –∞–¥–º–∏–Ω/–≤–ª–∞–¥–µ–ª–µ—Ü).</div>
    </div>

    <div class="card" style="margin-top:14px" id="section-tops">
      <h3>–¢–æ–ø—ã –ø–ª–µ–º–µ–Ω</h3>
      <div class="grids">
        <div class="list card">
          <h4>–¢–æ–ø –ø–æ –∞—Ä–º–∏–∏</h4>
          <table id="topArmy"><thead><tr><th>#</th><th>–ü–ª–µ–º—è</th><th>–ê—Ä–º–∏—è</th><th></th></tr></thead><tbody></tbody></table>
        </div>
        <div class="list card">
          <h4>–¢–æ–ø –ø–æ –Ω–∞—Å–µ–ª–µ–Ω–∏—é</h4>
          <table id="topPop"><thead><tr><th>#</th><th>–ü–ª–µ–º—è</th><th>–ù–∞—Å–µ–ª–µ–Ω–∏–µ</th><th></th></tr></thead><tbody></tbody></table>
        </div>
        <div class="list card">
          <h4>–¢–æ–ø –ø–æ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è–º</h4>
          <table id="topTerr"><thead><tr><th>#</th><th>–ü–ª–µ–º—è</th><th>–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏</th><th></th></tr></thead><tbody></tbody></table>
        </div>
        <div class="list card">
          <h4>–¢–æ–ø –ø–æ —É—Ä–æ–≤–Ω—é —Å—á–∞—Å—Ç—å—è</h4>
          <table id="topHappy"><thead><tr><th>#</th><th>–ü–ª–µ–º—è</th><th>–°—á–∞—Å—Ç—å–µ</th><th></th></tr></thead><tbody></tbody></table>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:14px" id="section-rules" hidden>
      <h3>–ü—Ä–∞–≤–∏–ª–∞ –∏ —Å–∏—Å—Ç–µ–º—ã</h3>
      <div class="accordion-item">
        <div class="accordion-head" onclick="toggleAccordion(this)">
          <div>üÜï –î–ª—è –Ω–æ–≤–∏—á–∫–æ–≤</div>
          <div class="small muted">–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å</div>
        </div>
        <div class="accordion-body">
          <p><strong>–ï—Å–ª–∏ —Ç—ã –Ω–æ–≤–∏—á–æ–∫, –≤–æ—Ç –∫–∞–∫ –∏–≥—Ä–∞—Ç—å:</strong></p>
          <ol>
            <li>–ü—Ä–∏–¥—É–º–∞–π –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–≤–æ–µ–π —Å—Ç—Ä–∞–Ω—ã</li>
            <li>–°–¥–µ–ª–∞–π —Ñ–ª–∞–≥</li>
            <li>–ù–∞–∑–æ–≤–∏ —Å—Ç–æ–ª–∏—Ü—É</li>
            <li>–í—ã–±–µ—Ä–∏ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</li>
            <li>–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Ç–µ–±—è –¥–æ–±–∞–≤—è—Ç –Ω–∞ –∫–∞—Ä—Ç—É</li>
          </ol>
          <p>–ö–∞–∂–¥—ã–π —á–∞—Å +20 ‚ö°Ô∏è, –º–∞–∫—Å–∏–º—É–º 100 ‚ö°Ô∏è. –ù–∞–ª–æ–≥–∏: 5‚Äî40 ‚ö°Ô∏è/—á–∞—Å. –°–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–µ ‚Äî —Ä–∏—Å–∫ –≤–æ—Å—Å—Ç–∞–Ω–∏—è.</p>
        </div>
      </div>

      <div class="accordion-item">
        <div class="accordion-head" onclick="toggleAccordion(this)">
          <div>üîã –≠–Ω–µ—Ä–≥–∏—è –∏ —Ä–∞—Å—Ö–æ–¥—ã</div>
          <div class="small muted">–ü–æ–¥—Ä–æ–±–Ω–æ</div>
        </div>
        <div class="accordion-body">
          <h4>–°–∏—Å—Ç–µ–º–∞ —ç–Ω–µ—Ä–≥–∏–∏</h4>
          <p>–ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç –ø–ª–µ–º—è –ø–æ–ª—É—á–∞–µ—Ç 15 —ç–Ω–µ—Ä–≥–∏–∏. –ú–∞–∫—Å–∏–º—É–º 100. –≠–Ω–µ—Ä–≥–∏—è —Ç—Ä–∞—Ç–∏—Ç—Å—è –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ, —Ä–∞–∑–≤–µ–¥–∫—É, –ø–æ—Ö–æ–¥—ã –∏ –ø—Ä.</p>
          <ul>
            <li>–£–ª—É—á—à–µ–Ω–∏–µ –ø–æ—Å–µ–ª–µ–Ω–∏—è ‚Äî 10 —ç–Ω–µ—Ä–≥–∏–∏</li>
            <li>–†–∞–∑–≤–µ–¥–∫–∞ ‚Äî 10‚Äì80 —ç–Ω–µ—Ä–≥–∏–∏</li>
            <li>–ó–∞—Ö–≤–∞—Ç —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ ‚Äî 20‚Äì80 —ç–Ω–µ—Ä–≥–∏–∏</li>
            <li>–û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–∞–∑–≤–µ–¥—á–∏–∫–æ–≤ ‚Äî 25 —ç–Ω–µ—Ä–≥–∏–∏</li>
            <li>–î–∞–ª—å–Ω–∏–π –ø–æ—Ö–æ–¥ ‚Äî 45 —ç–Ω–µ—Ä–≥–∏–∏</li>
          </ul>
        </div>
      </div>

      <div class="accordion-item">
        <div class="accordion-head" onclick="toggleAccordion(this)">
          <div>üß† –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∏ –∑–¥–∞–Ω–∏—è</div>
          <div class="small muted">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</div>
        </div>
        <div class="accordion-body">
          <p>–ò–º–µ—é—Ç—Å—è —É—Ä–æ–≤–Ω–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –∏ —à–∞–º–∞–Ω—Å—Ç–≤–∞ ‚Äî –∏—Ö —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ —ç–Ω–µ—Ä–≥–∏–∏ –ø—Ä–∏–≤–µ–¥–µ–Ω–∞ –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö.</p>
        </div>
      </div>

      <div class="accordion-item">
        <div class="accordion-head" onclick="toggleAccordion(this)">
          <div>‚ö†Ô∏è –í–æ—Å—Å—Ç–∞–Ω–∏–µ –∏ —Å—á–∞—Å—Ç—å–µ</div>
          <div class="small muted">–û–ø–∞—Å–Ω–æ—Å—Ç–∏</div>
        </div>
        <div class="accordion-body">
          <p>–°—á–∞—Å—Ç—å–µ –∏–∑–º–µ—Ä—è–µ—Ç—Å—è 0‚Äì100%. –ù–∏–∑–∫–æ–µ —Å—á–∞—Å—Ç—å–µ: —Ä–∏—Å–∫ –±—É–Ω—Ç–æ–≤, –ø–æ—Ç–µ—Ä—è —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–π –∏ –≤–æ–π—Å–∫.</p>
          <p>–ü–æ—Ä–æ–≥ –≤–æ—Å—Å—Ç–∞–Ω–∏—è: ‚â§30% ‚Äî –≤–æ–∑–º–æ–∂–µ–Ω –±—É–Ω—Ç, ‚â§10% ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–∏–µ.</p>
        </div>
      </div>
    </div>

    <div id="admin" class="card" style="margin-top:14px">
      <h3>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h3>
      <div class="small muted">–ó–¥–µ—Å—å ‚Äî –±—ã—Å—Ç—Ä—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã. –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–æ–ª—å –í–ª–∞–¥–µ–ª–µ—Ü/–ê–¥–º–∏–Ω –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.</div>

      <div style="margin-top:10px;display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div class="card">
          <h4>–ë—ã—Å—Ç—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h4>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button onclick="giveEnergyToSelected(20)">+20 ‚ö° –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É</button>
            <button onclick="modifyTax(15)">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞–ª–æ–≥–∏ +15 ‚ö°</button>
            <button onclick="randomEvent()">–°–ª—É—á–∞–π–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ</button>
            <button onclick="addDemoPlayer()">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç-–ø–ª–µ–º—è</button>
          </div>
        </div>

        <div class="card">
          <h4>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–∞–π—Ç–∞</h4>
          <div style="display:flex;flex-direction:column;gap:8px">
            <div>–í–ª–∞–¥–µ–ª–µ—Ü: <span id="ownerInfo" class="small muted">–Ω–µ –∑–∞–¥–∞–Ω</span></div>
            <button onclick="changePassword('owner')">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –≤–ª–∞–¥–µ–ª—å—Ü–∞</button>
            <button onclick="changePassword('admin')">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∞</button>
            <div class="small muted">–°–æ–≤–µ—Ç: –ø–æ—Å–ª–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª –Ω–∞ GitHub Pages / Netlify –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –±—ç–∫–µ–Ω–¥ –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.</div>
          </div>
        </div>
      </div>

    </div>

    <footer>
      –°–¥–µ–ª–∞–Ω–æ –¥–ª—è –∏–≥—Ä—ã ¬´–ù–æ–≤–∞—è –ó–µ–º–ª—è¬ª. –†–µ–∫–æ–º–µ–Ω–¥—É—é —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å —Å–∞–π—Ç –Ω–∞ –ª—é–±–æ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–º —Ö–æ—Å—Ç–∏–Ω–≥–µ –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.  
    </footer>

  </div>

  <div id="toast" class="toast" style="display:none"></div>

  <script>
    // ---------- –ü—Ä–æ—Å—Ç–∞—è –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage ----------
    const STORAGE_KEY = 'nova_zemlya_data_v1'

    // –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Äî –±–µ—Ä—ë–º –∏–∑ —Ç–µ–∫—Å—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –≤—ã –¥–∞–ª–∏
    const defaultData = {
      meta:{ownerName:'–í–ª–∞–¥–µ–ª–µ—Ü',ownerPass:'owner123',adminPass:'admin123',publicEdit:true},
      map:{dataUrl:'',name:''},
      players: [
        {id:1,name:'–ú–ï–¢–ê–ú–§–ò–õ–ï–ù–î',army:0,pop:7,territories:24,happy:50,energy:50},
        {id:2,name:'–°–Ω—é—Å–õ–µ–Ω–¥',army:0,pop:7,territories:0,happy:50,energy:50}
      ]
    }

    // –∑–∞–≥—Ä—É–∑–∫–∞ / –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    function loadState(){
      const raw = localStorage.getItem(STORAGE_KEY)
      if(!raw){
        localStorage.setItem(STORAGE_KEY, JSON.stringify(defaultData))
        return JSON.parse(JSON.stringify(defaultData))
      }
      try{ return JSON.parse(raw) }catch(e){ localStorage.setItem(STORAGE_KEY, JSON.stringify(defaultData)); return defaultData }
    }
    let state = loadState()

    // —Ä–æ–ª—å: 'guest' | 'admin' | 'owner'
    let role = 'guest'
    updateUI()

    // ---------- UI helpers ----------
    function toast(text, timeout=3000){
      const t = document.getElementById('toast')
      t.innerText = text; t.style.display='block'
      setTimeout(()=>t.style.display='none', timeout)
    }

    function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); renderAll(); }

    function renderAll(){ renderMap(); renderTops(); renderMarkers(); updateOwnerInfo(); }

    // ---------- Map upload / preview ----------
    function loadMap(e){
      const f = e.target.files[0]; if(!f) return
      const reader = new FileReader();
      reader.onload = ()=>{
        state.map.dataUrl = reader.result
        state.map.name = f.name
        saveState(); toast('–ö–∞—Ä—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞')
      }
      reader.readAsDataURL(f)
    }
    function resetMap(){ state.map = {dataUrl:'',name:''}; saveState(); }

    function renderMap(){ const img = document.getElementById('mapPreview'); if(state.map.dataUrl){ img.src = state.map.dataUrl; img.style.display='block' } else { img.style.display='none' } }

    // ---------- Markers demo (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π) ----------
    function renderMarkers(){ const wrap = document.getElementById('mapMarkers'); wrap.innerHTML=''
      state.players.forEach(p=>{
        const el = document.createElement('div'); el.className='card';
        el.innerHTML = `<strong>${p.name}</strong><div class="small">–ê—Ä–º–∏—è: ${p.army} ‚Ä¢ –ü–æ–ø: ${p.pop} ‚Ä¢ –¢–µ—Ä—Ä: ${p.territories} ‚Ä¢ –°—á–∞—Å—Ç—å–µ: ${p.happy}%</div>
          <div style="margin-top:8px;display:flex;gap:6px"><button onclick="selectPlayer(${p.id})">–í—ã–±—Ä–∞—Ç—å</button><button onclick="openEditPlayer(${p.id})">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button></div>`
        wrap.appendChild(el)
      })
    }

    function selectPlayer(id){ const p = state.players.find(x=>x.id===id); if(!p) return toast('–ü–ª–µ–º—è –Ω–µ –Ω–∞–π–¥–µ–Ω–æ'); window.selectedPlayer = p; toast('–í—ã–±—Ä–∞–Ω: '+p.name) }

    function openEditPlayer(id){ if(!canEdit()) return toast('–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–æ–ª—å –ê–¥–º–∏–Ω/–í–ª–∞–¥–µ–ª–µ—Ü'); const p = state.players.find(x=>x.id===id); if(!p) return
      const name = prompt('–ù–∞–∑–≤–∞–Ω–∏–µ –ø–ª–µ–º–µ–Ω–∏', p.name); if(name!==null) p.name = name
      const army = parseInt(prompt('–ê—Ä–º–∏—è', p.army)) || p.army
      const pop = parseInt(prompt('–ù–∞—Å–µ–ª–µ–Ω–∏–µ', p.pop)) || p.pop
      const terr = parseInt(prompt('–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏', p.territories)) || p.territories
      const happy = parseInt(prompt('–°—á–∞—Å—Ç—å–µ (0-100)', p.happy)) || p.happy
      p.army = army; p.pop = pop; p.territories = terr; p.happy = happy
      saveState(); toast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ') }

    // ---------- Tops rendering ----------
    function renderTops(){ renderTable('topArmy','army'); renderTable('topPop','pop'); renderTable('topTerr','territories'); renderTable('topHappy','happy') }
    function renderTable(elId, key){ const tbody = document.getElementById(elId).querySelector('tbody'); tbody.innerHTML=''
      const arr = [...state.players].sort((a,b)=>b[key]-a[key]).slice(0,12)
      arr.forEach((p,i)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${i+1}</td><td>${p.name}</td><td>${p[key]}</td><td><button onclick="editRow(${p.id})">‚úèÔ∏è</button></td>`
        tbody.appendChild(tr)
      })
    }

    function editRow(id){ if(!canEdit()) return toast('–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–æ–ª—å –ê–¥–º–∏–Ω/–í–ª–∞–¥–µ–ª–µ—Ü'); openEditPlayer(id) }

    // ---------- Roles / Auth (–ø—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –¥–µ–º–æ) ----------
    function promptLogin(kind){ const pass = prompt('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å ('+kind+')'); if(!pass) return; const meta = state.meta
      if(kind==='owner' && pass===meta.ownerPass){ role='owner'; toast('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω –∫–∞–∫ –í–ª–∞–¥–µ–ª–µ—Ü'); updateUI(); return }
      if(kind==='admin' && pass===meta.adminPass){ role='admin'; toast('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω –∫–∞–∫ –ê–¥–º–∏–Ω'); updateUI(); return }
      toast('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å') }

    function canEdit(){ return role==='admin' || role==='owner' || state.meta.publicEdit }

    function updateUI(){ document.getElementById('roleBadge').innerText = role==='guest' ? '–ì–æ—Å—Ç—å' : (role==='admin' ? '–ê–¥–º–∏–Ω' : '–í–ª–∞–¥–µ–ª–µ—Ü'); renderAll(); }

    function changePassword(kind){ if(role!=='owner') return toast('–¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å –ø–∞—Ä–æ–ª–∏'); const np = prompt('–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –¥–ª—è '+kind); if(!np) return; if(kind==='owner') state.meta.ownerPass = np; else state.meta.adminPass = np; saveState(); toast('–ü–∞—Ä–æ–ª—å –æ–±–Ω–æ–≤–ª—ë–Ω') }

    function updateOwnerInfo(){ document.getElementById('ownerInfo').innerText = state.meta.ownerName + (state.meta.publicEdit ? ' ‚Ä¢ –ø—É–±–ª–∏—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –í–ö–õ' : ' ‚Ä¢ –ø—É–±–ª–∏—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –í–´–ö–õ') }

    function togglePublicEdit(){ if(role!=='owner'){ state.meta.publicEdit = !state.meta.publicEdit; saveState(); toast('–ü—É–±–ª–∏—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: '+(state.meta.publicEdit ? '–í–ö–õ' : '–í–´–ö–õ')); return }
      // –≤–ª–∞–¥–µ–ª–µ—Ü ‚Äî –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å
      state.meta.publicEdit = !state.meta.publicEdit; saveState(); toast('–ü—É–±–ª–∏—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: '+(state.meta.publicEdit ? '–í–ö–õ' : '–í–´–ö–õ')) }

    // ---------- Actions / Quick functions ----------
    function giveEnergyToSelected(n){ if(!window.selectedPlayer) return toast('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–ª–µ–º—è'); window.selectedPlayer.energy = Math.min(100, (window.selectedPlayer.energy||0)+n); saveState(); }
    function modifyTax(n){ // –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è: —É–º–µ–Ω—å—à–∏–º —Å—á–∞—Å—Ç—å–µ —É –≤—Å–µ—Ö
      state.players.forEach(p=>{ p.happy = Math.max(0, p.happy - Math.round(n/2)) }); saveState(); toast('–ù–∞–ª–æ–≥–∏ –∏–∑–º–µ–Ω–µ–Ω—ã ‚Äî —Å—á–∞—Å—Ç—å–µ —É–ø–∞–ª–æ') }

    function quickAction(action){ if(action==='giveEnergyAll'){ state.players.forEach(p=>p.energy = Math.min(100,(p.energy||0)+20)); saveState(); toast('+20 —ç–Ω–µ—Ä–≥–∏–∏ –≤—Å–µ–º –ø–ª–µ–º–µ–Ω–∞–º') }
      if(action==='randomEvent'){ randomEvent() } }

    function randomEvent(){ const ev = Math.random()
      if(ev<0.33){ state.players.forEach(p=>p.happy = Math.max(0,p.happy-5)); toast('–ü—Ä–æ–∏–∑–æ—à–ª–∏ –ø–æ–∂–∞—Ä—ã ‚Äî —Å—á–∞—Å—Ç—å–µ —É–ø–∞–ª–æ') }
      else if(ev<0.66){ state.players.forEach(p=>p.pop = Math.max(1,p.pop-1)); toast('–≠–ø–∏–¥–µ–º–∏—è ‚Äî –Ω–∞—Å–µ–ª–µ–Ω–∏–µ —Å–Ω–∏–∑–∏–ª–æ—Å—å') }
      else{ state.players.forEach(p=>p.army += 5); toast('–£—Å–ø–µ—Ö –≤ –±–æ—é ‚Äî –∞—Ä–º–∏—è –≤—ã—Ä–æ—Å–ª–∞') }
      saveState()
    }

    // ---------- Export / Import ----------
    function exportData(){ const data = JSON.stringify(state, null, 2); const blob = new Blob([data],{type:'application/json'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='nova_zemlya_data.json'; a.click(); URL.revokeObjectURL(url); }
    function importData(e){ const f = e.target.files[0]; if(!f) return; const r=new FileReader(); r.onload=()=>{ try{ const obj = JSON.parse(r.result); if(obj && obj.players){ state = obj; saveState(); toast('–î–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã'); } else toast('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–∞–π–ª'); }catch(err){ toast('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞') } }; r.readAsText(f) }

    // ---------- Demo: –¥–æ–±–∞–≤–∏—Ç—å –ø–ª–µ–º—è ----------
    function addDemoPlayer(){ if(!canEdit()) return toast('–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–æ–ª—å –ê–¥–º–∏–Ω/–í–ª–∞–¥–µ–ª–µ—Ü'); const id = Date.now(); state.players.push({id, name:'–ù–æ–≤—ã–π_'+id%1000, army:0, pop:5, territories:0, happy:50, energy:50}); saveState(); }

    // ---------- Edit row helper ----------
    function editRowInline(id,key){ /* –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å */ }

    // ---------- Misc UI ----------
    function showSection(name){ document.querySelectorAll('[id^="section-"]').forEach(el=>el.hidden=true); const el = document.getElementById('section-'+name); if(el) el.hidden=false; if(name==='map') renderMap(); }
    function scrollTo(sel){ const el = document.querySelector(sel); if(el) el.scrollIntoView({behavior:'smooth'}) }

    function toggleAccordion(head){ const body = head.nextElementSibling; if(body.style.display==='block') body.style.display='none'; else body.style.display='block' }

    // ---------- initialize UI from state ----------
    renderAll()

    // first render ‚Äî fill tables
    renderTops()

    // expose some functions to console for convenience
    window.saveState = saveState; window.state = state; window.loadState = loadState; window.canEdit = canEdit
  </script>
</body>
</html>
